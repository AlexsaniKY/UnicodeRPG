<!DOCTYPE html>
<html>
<head>
	<title>Page Title</title>
	<meta charset=utf-8>
	<style rel="stylesheet" type="text/css">
		.grid-con{
			font-family:monospace;
			font-size:16px;
			display:grid;
			grid-gap:0;
		}

		.grid-tile{
			display:flex;
			justify-content:center;
			align-items:center;
		}
		
		.spr-con{
			position:relative;
			top:-1em;
			left:-.5ch;
		}
	</style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>

	
		<div style="display:grid; grid-gap:0; grid-template-columns: repeat(10, 1fr); height:5em; width:15ch;">
		<div>a</div>
		<div>b
		</div>
		<div>c</div>
		<div>d</div>
		<div>e</div>
		<div>f</div>
		<div>g</div>
		<div>h</div>
		<div>i</div>
		<div>j</div>

		<div>a</div>
		<div>0</div>
		<div class="grid-tile" style="background-color:lightblue; ">
			<div id="anim-div" class="spr-con">
					<p style="position:absolute; top:-.8em; left:-.2ch; color:green;">&#x13dc</p>
					<p style="position:absolute; top:-.3em; left:.3ch; color:brown;">i</p>
			</div>
		</div>
		<div>d</div>
		<div>e</div>
		<div>f</div>
		<div>g</div>
		<div>h</div>
		<div>i</div>
		<div>j</div>
		
		<div>a</div>
		<div>b</div>
		<div class="grid-tile" style="background-color:lightblue; ">
			<div class="spr-con">
					<p style="position:absolute; top:-.5em; left:-.2ch; color:green;">&#x22ce</p>
			</div>
		</div>
		<div>d</div>
		<div>e</div>
		<div>f</div>
		<div>g</div>
		<div>h</div>
		<div>i</div>
		<div>j</div>
		
		<div>a</div>
		<div>b</div>
		<div>c</div>
		<div>d</div>
		<div>e</div>
		<div>f</div>
		<div>g</div>
		<div>h</div>
		<div>i</div>
		<div>j</div>
	</div>

	<div id="new-grid-div" class="grid-con"></div>

<script>
	//sprite base is used to clone character based sprites
	let sprite_base = document.createElement("div");
	sprite_base.className = "spr-con";
	//sprite part base is used to clone each character in a sprite
	let sprite_part_base = document.createElement("p");
	sprite_part_base.style.position = "absolute";
	
	let sprites = [
		{
			name: "Grass",
			chars:[{
					ch: "&#x22ce",
					color: "green",
					offsetX: .05,
					offsetY: -.6
					}
				]
		},
		{
			name: "Tree",
			chars:[{
					ch: "&#x13dc",
					color: "green",
					offsetX: -.2,
					offsetY: -.8
					},
					{
					ch: "i",
					color: "brown",
					offsetX: 0,
					offsetY: -.3
					}
				]
		},
		{
			name: "Dirt",
			chars:[{
					ch: "&#x289e",
					color: "sandybrown",
					offsetX: .0,
					offsetY: -.8
					}
				]
		}
	];
	
	
	let tileset = {
		0: "Grass",
		1: "Tree",
		2: "Dirt"
	};
	let map = [
		[1,1,1,1,1],
		[1,0,0,2,1],
		[1,0,2,2,1],
		[1,0,2,0,1],
		[1,1,2,1,1]
	];
	
	
	
	function node_from_sprite(sprite_object){
		let sprite = sprite_base.cloneNode();

		let sprite_part;
		for(s of sprite_object.chars){
			sprite_part = sprite_part_base.cloneNode();

			sprite_part.innerHTML = s.ch;
			sprite_part.style.color = s.color;
			sprite_part.style.top = s.offsetY + "em";
			sprite_part.style.left = s.offsetX + "ch";

			sprite.appendChild(sprite_part);
		}
		return sprite;
	}
	
	
	//animate positioning
	let animdiv = document.getElementById("anim-div");
	
	let move_p = document.createElement("p");
	move_p.style.position = "absolute";
	move_p.style.top = "-.5em";
	move_p.style.left = "-.3ch";
	move_p.innerHTML = "Q";
	move_p.id = "the-p";
		
	while(animdiv.firstChild){
		animdiv.removeChild(animdiv.firstChild);
	}

	animdiv.appendChild(move_p);
		let p;
	setInterval(() => {
		p = document.getElementById("the-p");
	
		p.style.top = "calc(-.5em + " + Math.round( 10 * Math.random() -5) + "px)"; 
		p.style.left = "calc(-.3ch + " + Math.round( 10 * Math.random() -5) + "px)";
		}, 200);
	
	
	//programmatic grid definitions
	let grid_template = document.createElement("div");
	grid_template.className = "grid-con";
	
	let gridtile = document.createElement("div");
	gridtile.className = "grid-tile";
	
	function createGrid(x, y, width, height){
		let newgriddiv = grid_template.cloneNode();
		newgriddiv.style.gridTemplateColumns = "repeat(" + x + ", 1fr)";
		newgriddiv.style.height = height;
		newgriddiv.style.width = width;
		let clone;
		for(let row=0; row<y; row++){
			for(let col=0; col<x; col++){
				clone = gridtile.cloneNode(true);
				clone.id = "" + row + "," + col;
				newgriddiv.appendChild(clone);
			}
		}
		return newgriddiv;
	}
	
	//initialize letter grid
	
	//let newgriddiv = document.getElementById("new-grid-div");
	//newgriddiv.replaceWith(createGrid(10,10, "20ch" , "15em"));

	function node_from_map(map, tileset, sprites){
		let sprite_nodes = {};
		for(s of sprites) sprite_nodes[s.name] = node_from_sprite(s);
	
		let x = map[0].length;
		let y = map.length;
		let grid = createGrid(x, y, x*2 + "ch", y*1.5 + "em");
		
		let node;
		for(let j = 0; j < y; j++){
			for(let i = 0; i < x; i++){
				node = grid.childNodes[j*y + i];
				console.log(node);
				console.log(sprite_nodes[tileset[map[j][i]]]);
				node.appendChild( sprite_nodes[ tileset[ map[j][i]] ].cloneNode(true) );
			}
		} 
		return grid;
	}
	
	let body = document.getElementsByTagName("body")[0];
	body.appendChild(node_from_map(map, tileset, sprites));
	
	//let tile;
	//let spr;
	//let spr_p;
	//for(let y=0; y<10; y++){
	//	for(let x=0; x<10; x++){
	//		tile = document.getElementById(y + "," + x);
	//		spr = sprite_base.cloneNode();
	//		spr_p = sprite_part_base.cloneNode();
	//		spr_p.style.top = "-.5em";
	//		spr_p.innerHTML = "&#" + ((10*y + x)%26 + 65);
	//		
	//		spr.appendChild(spr_p);
	//		tile.appendChild(spr);
	//		}
	//	}
		
		
		
	let grass_element = document.getElementById("3,3");
	while(grass_element.firstChild){
		grass_element.removeChild(grass_element.firstChild);
	}
	grass_element.appendChild(node_from_sprite(sprites[0]));
	
	let tree_element = document.getElementById("4,4");
	while(tree_element.firstChild){
		tree_element.removeChild(tree_element.firstChild);
	}
	tree_element.appendChild(node_from_sprite(sprites[1]));
		
</script>
</body>
</html>